TYPO3 на базе Fluid: концепции - шаблоны
========================================

## Введение

Шаблоны, формируемые с использовнием Flux, то есть почти все шаблоны для TYPO3 на базе Fluid, лишь немногим отличаются от обычных
шаблонов Fluid. В этом описании концепции акцент сделан на различиях, и лишь очерчены многие настройки и проекторы
(ViewHelpers), которые могут использоваться для настройки шаблонов. Поэтому, перед чтением материала ниже,
необходимо хотябы вкратце ознакомиться с тем, как использовать шаблоны Fluid в расширениях на Extbase.

Эта концепция описывает лишь передовой опыт. Существует множество способов использования шаблонов с Flux,
каждый из которых имеет право на существование, но лишь один считается передовым: [расширение поставщик](ProviderExtensions.md)
, использующее класс `FluidTYPO3\Flux\Core` для регистрации информации о том, какие типы шаблонов имеются в расширении поставщике.

### Слой API 1

Эта концепция - одна из простейших для изучения, и используется в повседневной работе. Она почти не требует знаний о TYPO3,
и почти не имеет дело с кодом PHP. Она связана с файлами шаблонов и основными файлами настроек.

## Что такое шаблон Flux?

Файл шаблона, используемый Flux точно такой же, как и обычный файл шаблона fluid, со следующими требованиями:

1. Должна быть обозначена область имен (namespace) `{namespace flux=FluidTYPO3\Flux\ViewHelpers}`.
2. Должен присутствовать раздел `Configuration`, созданные посредством тега `f:section`.

Внутри раздела `Configuration` (или с другим названием, если не следовать принятым соглашениям) необходимо поместить тег
`flux:form`, с указанием по крайней мере атрибута `id`, значение которого должно быть в `нижнемГорбатомСинтаксисе`, например,
`specialImage`.

Существует необязательный раздел, который можно добавить при использовании шаблона Fluid с таблицей `tt_content` - `Preview`
(опять же, добавляется посредством тега `f:section`), где можно разместить HTML, выводимый в моделе Страница (Page) внутреннего
 интерфейса TYPO3 при просмотре этой записи. Это автоматически работает для дополнений, использующих Flux (включая элементы,
 работающие с `fluidcontent`).

И последнее соглашение, которому *нужно* следовать для упрощения работы, но которое *можно* при необходимости проигнорировать -
 название раздела, отвечающего за фактический вывод содержимого на страницы сайта, должно быть `Main`. Этот раздел (section)
 формируется из используемого макета (Layout), то есть, при необходимости для него можно выбрать и другое название. Но
 используя название `Main` упрощает работу с шаблоном для других - они будут знать, для чего нужен это раздел.

> #### Индивидуальные настройки
>
> Название раздела (section) `Configuration` можно изменить в своем [классе провайдера](Providers.md). Также можно использовать
 несколько разделов (section), и переключаться между ними в провайдере на основе, например, значения в записи или TypoScript,
 сессии пользователя и т. п.

Пример экстримально минимального шаблона (пример: шаблон элемента `fluidcontent`):

```xml
{namespace flux=FluidTYPO3\Flux\ViewHelpers}
<f:layout name="Content" />
<f:section name="Configuration">
    <flux:form id="myContentElement" />
</f:section>
<f:section name="Main">
    My content element
</f:section>
```

Как видите, минимум необходимого в соответствие двух основным требованиям выше и использование соглашения об именовании для
макета (Layout), которое будет объяснено в следующей главе. При добавлении в коллекцию шаблонов `fluidcontent`,
этот шаблон реализует тип элемента под названием "myContentElement" без каких-либо настроек, значка, меток,
а при выводе будет просто выводить текст "My content element" без всякого контейнера HTML.

## Layouts - макеты и Partials - шаблонные фрагменты

Как в любых других шаблонах Fluid, здесь можно использовать любое желаемое название для макета (Layout). Но в TYPO3 на базе
Fluid желательно использовать названия `Default`, `Content`, `CoreContent` и `Page`. Ниже разъясняется когда и какое название
нужно использовать:

* `Page` при использовании макета (Layout) с шаблонами страниц посредством `fluidpages`. Предполагается,
   что все шаблоны страниц используют общий файл макета (Layout), хотя иногда необходимы и другие макеты (Layout) с названиями
   вроде `FrontPage`, `SubPage` и т. п., в соответстве с собственными предпочтениями.
* `Content`, когда макет (Layout) предназначен для элементов `fluidcontent` - обычно для всех элементов нужен лишь один макет
   (Layout), но, как и для страниц, можно разделять макет на, например файлы `MediaContent`, `TextContent` и т. п.
* `CoreContent`, когда макет (Layout) предназначен для элементов `fluidcontent_core`. Именно в этом расширении соблюдение этого
  правила **очень** важно для элементов содержимого ядра.
* `Default`, когда, например, все содержимое файла макета (Layout) имеют лишь `<f:render />` указание на формирование одного
  раздела (section). Если макет (Layout) HTML настолько прост, то общий файл макета даст небольшой прирост производительности и
   повышает прозрачность - компиляция одного файла быстрее, чем нескольких, и запутаться в поиске при в одном файле просто
   невозможно ;)

Помимо правил именования, для макетов (Layout) более нет правил или рекомендаций со стороны TYPO3 на базе Fluid. И только вы,
как разработчик, можете решать, что, если это нужно, будет в макетах.

Шаблонные фрагменты - Partials не имеют ограничений по своему наполнению. Они предназначены для повторяющихся предпросмотров,
общих полей форм Flux, определений сеток и т. п., необходимо лишь поместить тег `f:render` в нужное место, чтобы их "подключить".

## Определение пути для режима (View) в TypoScript

Flux автоматически ищет шаблоны по в местоположении по умолчанию, даже если не добавлять никаких настроек,
но можно (и даже нужно) добавить свою настройку для режимов (View) через TypoScript. Производится это точно также,
как и для любых других расширений Extbase/Fluid, и здесь об этом не рассказывается. Дополнительную информацию об этих
настройках в TypoScript говориться в [концепции расширений поставщиков](ProviderExtensions.md).

Расширения, использующие Flux, как и любые другие расширения на Extbase, ищут шаблоны в `plugin.tx_yourextwithoutunderscores.view`.

Изменение настроек через TypoScript для таких путей также влияет на Flux, как и на другие расширения. Flux берет во внимание
новый путь, вместо старого. Стоит отметить, что возможно использовать пути-накладки, а как это сделать,
можно прочитать в [документации по EXT:view по путям-накладкам](https://github.com/FluidTYPO3/view#template-path-overlays). То
же справедливо для `fluidcontent`, `fluidpages` и т. е. - любом расширении с использованием Flux это поддерживается, без
необходимости установки  EXT:view. Для поддержки наложения в не Flux расширениях, просто установите EXT:view,
и все станет также.

### Альтернатива шаблонам

> Внимание! Некоторый функционал из TYPO3 на базе Fluid требует, чтобы в файлах шаблонов был раздел `Configuration` и тег
> `flux:form`. Хотя возможно обойти и это требование, создав свой класс Provider вместо включаемого через расширение, например,
> `fluidcontent` ContentProvider, `fluidpages` PageProvider, и так далее. Замена провайдера решает все вопросы,
> включая решения по работе функционала относительно конкретного сайта. Разработка API делалась в расчете на то,
> чтобы весь функционал, вроде `fluidcontent`, имел бы тот же уровень доступа к API, что и пользовательские провайдеры. То есть, то,
> что могут эти расширения, точно сможете сделать и вы самостоятельно.

Имейте ввиду, что существует альтернатива рамещению формы с полями внутри шаблона. При использовании своего класса [Provider]
(Providers.md), можно возвращать из него объекты PHP непосредственно из методов `getForm` и `getGrid`. Ваш провайдер наследует
эти два метода из класса Flux `AbstractProvider`, благодаря чему, собственный провайдер будет способен выискивать в файле
шаблона экземпляры Form и Grid. Переназначение любого их этих методов, то есть, чтение Form и Grid, соответственно,
не потребует чтения самого файла шаблона.

А это означает, что при возвращении сырых объектов PHP из экземпляра провайдера Form *и/или* Grid,
в самом файле шаблона становится не нужным более раздел (section) `Configuration` и любое определение `flux:form`.
Разработанный вами провайдер может даже возвращать напрямую HTML, что позволяет обойти также раздел `Preview`. Конечно,
упомянутый раздел `Previews` применим лишь к записям `tt_content`.

Дополнительную информацию по этой области можно почерпнуть из [концепции класса провайдера](Providers.md). Обратите внимание,
что провайдеры относятся к **слою 2** API, ввиду чего, сложнее для изучения, чем обычные использование обычных шаблонов.
