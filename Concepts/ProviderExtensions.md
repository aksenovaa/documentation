TYPO3 на базе Fluid: концепции - расширения поставщики (Provider Extensions)
============================================================================

## Введение

Эта концепция описывает лишь передовой опыт. Наследие прошлого - размещение файлов шаблонов в `fileadmin`, как это делалось,
например, в TemplaVoila, признано устаревшим, и здесь не рассмартивается. Новый подход - размещение шаблонов в расширениях,
вот о чем эта глава.

### Устранение неоднозначности

Концепцию [расширений поставщиков (Provider Extensions)](ProviderExtensions.md) (этот документ) нельзя путать с концепцией
[Провайдеров](Providers.md). Концепция раширений поставщиков говорит о структуре файлов, а концепция Провайдеров - о типе класса.

### Слой API 1

Эта концепция - одна из простейших для изучения, и используется в повседневной работе. Она почти не требует знаний о TYPO3,
и почти не имеет дело с кодом PHP. Она связана с файлами шаблонов и основными файлами настроек.

## Что такое расширения поставщики - Provider Extension?

Расширения поставщики - такие же расширения, но поставляющие (то есть, содержащие, настраивающие и сообщающие) шаблоны и код,
который затем может быть прочитан Flux. Информация, усвоенная Flux, затем может быть использована в других функциях, вроде
`fluidpages` и `fluidcontent`. Идея, стоящая за раширениями поставщиками, - построение структуры для шаблонов на основе давно
известных правил.

## Почему расширение, а не просто хранение файлов где-либо?

Хотя мы и понимает, что это не простой путь, и, кроме того, путь, не использовавшийся в последнее время в TemplaVoila,
мы надеемся, что следующие моменты объяснят, почему этот подход лучше, чем файлы, например, в `fileadmin`:

1. Расширени отлично подходят для повторного использования. Скачайте их с одного сайта и загрузите на другой,
   и если шаблоны содержат _и_ настройки для их использования, то коллекция шаблонов может быть использована в гораздо большем
   количестве мест, а не на лишь одном единственном сайте (пример этого: `fluidcontent_bootstrap` - расширение поставщик,
   специально разработанное для использования на множестве сайтов, использующих механизм Twitter Bootstrap CSS - здесь есть все
    необходимое для Bootstrap).
2. Расширение, с точки зрения TYPO3 - **логический контекст**, который определяется уникальным ключом. И это четко отделяет
   одну коллекцию шаблонов от другой. Это отличается от правила, например, расположения шаблонов в `fileadmin/html`,
   это означает, что можно иметь несколько коллекций одновременно без риска коллизий. И, как уже было сказано, это значит,
   что шаблоны стали переносимыми.
3. Упаковка в расширение дает Flux способ построения надлежащего `контекста контроллера - ControllerContext` для его
   использования при доступе к шаблонам. И это, наряду с прочим, означает, что можно использовать короткие наименования LLL
   меток, а Fluid автоматически будет использовать правильный файл LLL. То же справедливо к местоположению ресурсов, например,
   изображений, стилей и сценариев, использующихся в шаблонах. Надлежащий контекст позволяет как Fluid, так и Extbase "знать",
   где искать нужные файлы. Знание ключа расширения означает знание используемых для файлов путей.

Хотя есть, разумеется, и другие выгоды (эффективный контроль версий, правила для настроек TS,
переназначаемые пути к режимам - view), эти три довода должны быть достаточными для перехода к использованию расширений,
вместо помещения файлов в `fileadmin`, все это значительно ускорит работу и сохранит много времени,
особенно при работе с ресурсами (включая LLL).

Но если и этого недостаточно, другие возможности TYPO3 на базе Fluid подразумевают использование расширений - мы и
разрабатывали все это в тесной связи друг с другом, так чтобы расширение поставщик могло бы содержать шаблоны содержимого и
страниц, дополнения, модули внутреннего интерфейса и все остальное в одном пакете, что идеально для распространения всего
дизайна сайта наряду со всеми настройками и зависимостями, обозначенными как зависимости от других расширений,
которые установит модуль управления расширениями TYPO3.

Это объясняет, почему наше лучшее достижение, несмотря на то, что из-за этого приходится писать подробную документацию,
- расширения поставщики (Provider Extension). Только такой подход имеет огромное количество преимуществ и не требует хаков для
интеграции в TYPO3.

## Файловая структура

Файлы в расширениях поставщиках всегда должны следовать следующим правилам в форматах:

```
typo3conf/ext/myproviderextension
__ Configuration
____ TypoScript
______ constants.txt
______ setup.txt
__ Resources
____ Private
______ Language
________ locallang.xlf
______ Layouts
______ Partials
______ Templates
________ Content
________ Page
____ Public
______ Javascript
______ Stylesheet
______ Images
__ ext_emconf.php
__ ext_icon.gif
__ ext_tables.php
__ ext_localconf.php
```

И должно быть понятно уже из тоо, что мы _используем правила Extbase о местоположении настроек и папок для шаблонов и файлов_,
и того, что _расширение поставщик - это обычное расширение TYPO3 с определенной файловой структурой_. А использование каждой
папки обычно зависит от типа создаваемого расширения поставщика, ну а руководство по созданию определенного функционала всегда
начинается с объяснения структуры папок и файлов.

Файлы `ext_localconf.php` и `ext_tables.php` должны содержать различные запросы к Flux для регистрации иноформации о том,
какие шаблоны Flux используются в расширении поставщике, наряду с другими необходимыми настройками,
например, полями TCA для `tt_content`. Папка `Resources/Private` содержит структуру шаблона и языковые файлы,
сам шаблон разделен на вложенные папки, по названию которых контроллер и будет определенным образом выводить их (например,
во `fluidpages` контроллер называется `PageController` - а это значит, что папка должна называться `Page`,
во `fluidcontent` контроллер называется `ContentController`, а папка -`Content`, и так далее). Как обычно поддерживаются макеты
(Layouts) и шаблонные фрагменты (Partials). И наконец, папка `Configuration` содержит TypoScript,
посредством которого расширение делает возможным для интеграторов выбор и использование своих ресурсов в TYPO3,
при его установке.

## Что должно находиться в файлах шаблонов?

Фактическое содержимое файлов шаблона зависит от их предназначения, но есть и несколько общих правил,
о которых можно прочитать в главе о [концепции шаблонов](Templates.md) этой документации. Следование стандартам гарантирует
работу и возможность выбора (пока еще из немногих) шаблонов, а что еще должно быть в файлах зависит от каждой конкретной
реализуемой функции.

Обязательными стандартными файлами являются расположенные в папке `Templates`, другими словами: макеты (Layouts) и шаблонные
фрагменты (Partials) могут содержать все, что угодно, но шаблоны (Templates) должны следовать спецификации Flux.

Детально об этих файлах рассказывается в [концепции шаблонов(Templates.md).

## Установка и использование расширений поставщиков

Расширение поставщик устанавливается также, как и всякое другое в TYPO3 - через модуль управления расширениями,
а затем необходимо подключить его статический шаблон TypoScript. Некоторым расширениям поставщикам необходима установка
параметров TypoScript в константах (constants) и/или настройке (setup). Но в любом случае,
настройка по правилам проводится указанными способами.

Использование расширения поставщика зависит от функционала, который оно представляет, например,
`fluidpages` позволяет выбирать шаблон из расширения поставщика во время редактирования свойств страницы,
`fluidcontent` - добавлять элементы содержимого, формирующие предоставленные шаблоны `Content`. Другие функции позволяют
выбирать, настраивать и выводить шаблоны самым разным образом - кажая функция описана в документации: как именно они используют
 шаблоны из расширения поставщика и что конкретно должно присутствовать при этом в шаблонах (templates.

## Пользовательские контроллеры в расширениях поставщиках

Некоторые функции TYPO3 на базе Fluid, вроде `fluidcontent` и `fluidpages`, поддерживают пользовательские классы контроллеров,
которые Flux будет использовать вместо встроенные в эти функции контроллеров. Фактически это дает очень большую гибкость
(например, пользовательский `PageController` может воспринимать указанные аргументы в действии (action),
соответствующем выводимому шаблону). Если добавляются свои классы контроллеров, то их именования и расположения должны
следовать правилам Extbase:

```
typo3conf/ext/myproviderextension
__ Classes
____ Controller
______ PageController.php
______ ContentController.php

```

Здесь применяется [концепция контроллера Flux](FluxControllers.md), документ по ссылке содержит доступную информацию о таких
пользовательских классах контроллеров и о их возможных действиях. Но эта концепция уже относится к **слою 2**,
который более сложен для восприятия и использования, чем простой подход шаблоны-проекторы-TypoScript.

## Добавление пользовательского дополнения в расширение поставщик

Явно говорим об этом, так как это не очевидно: наряду с шаблонами и настройками, расширение поставщик может содержать и
дополнения Extbase, и дополнения, и шаблоны могут даже использовать одни и те же настройки (setup) TypoScript,
так как они разделяют одну и ту же область расширения, как уже разъяснялось выше.

Едиственное, с чем нужно обращаться осторожно - не использовать зарезервированных названий контроллеров: `Content`, `Page`,
`CoreContent` или `Backend`, при (и только при этом) вы собираетесь воспользоваться любой из этих функций из `fluidcontent`,
`fluidpages`, `fluidcontent_core`, и `fluidbackend`, соответственно. Если какая-либо функция не используется,
конечно можно воспользоваться зарезервированным название контроллера в своих целях, но рекомендуем воздержаться от подобного,
так как нельзя быть уверенным, что в дальнейшем они не понадобяться в одном их ваших расширениях поставщиках.
