3.2.4 Поля Flux
===============

Вы уже видели несколько примеров различных `flux:field.*` проекторов/ViewHelpers в шаблонах страниц и содержимого. Это так
называемые **компоненты форм Flux** — специальная группа компонентов, определяющих поля формы формируемой в TYPO3.

Как уже знаете, Flux связывает записи с файлами шаблона — вот почему поля Flux могут быть сформированы при редактировании
определённой записи. Проиллюстрируем: Fluidcontent имеет специальное поле, выбирающее "Тип содержимого Fluid". Таким образом здесь устанавливается значение при сохранении записи и при её дальнейшем редактироваии, а Fluidcontent будет использовать разные файлы шаблона, содеращие разные поля в форме. Так поля шаблона Flux превращаются в поля формы настроек в TYPO3.

### Что такое компоненты форм Flux

Сам TYPO3 ожидает определения форм в формате массива, известного как TCEforms. Такой массив можно использовать для описания
формы для записи, но он же может использоваться и для описания структуры формы для единственного поля в записи. Такая концепция
 однопольной-формы-TCEform известна как **FlexForms** (название пришло из типа поля TCEforms под названием **flex**). При
 описании структуры формы с одним полем, TYPO3 сформирует массив TCEforms в виде вложенной формы (где, например, поле ввода/input будет сформировано так, как если бы в TCA указать тип поля `input`, вместо поля типа `flex`). Проиллюстрируем: поле `tt_content.pi_flexform` имеет тип `flex` и мы называем форму, формируемую внутри этого поля `FlexForm`.

Такой подход с исползованием массива приводит к громоздкой и очень сложной структуре, что и служит ограничением для Flux и поводом к созданию структурированного API для создания подобных определений. Во Flux это достигается добавлением двух дополнительных слоёв API:

1. На основе PHP, объектно-ориентированные, иерархически структурированные объекты, расположенные во `FluidTYPO3\Flux\Form` — это самый нижний слой API, добавляемый Flux. При этом иерархия объектов может "строится" в виде массива TCEforms, который обрабатывается TYPO3.
2. Слой проекторов/ViewHelper, где Fluid проекторы/ViewHelpers используются для создания и размещения объектов формы Flux в
иерархию посредством объектов PHP нижележащего слоя API.
 
Более употребимая API, разумеется, на основе проекторов/ViewHelper. Именно его аура позволяет определять _внутри шаблона_ поля
форм, которые можно редактировать, а значения хранить в виде переменных, используемых в шаблоне.

### Как работают компоненты форм Flux

Компоненты, вроде TCA и TCEforms, работают в виде _матрёшки_ — каждый тип компонента должен работать на определённом уровне: `Вкладка/Sheet` находится внутри `Формы/Form`, `Поле/Field` — внутри `Вкладки/Sheet` или другого контейнера, поддерживающего поля, а именно: `Объект/Object` и `Контейнер/Container`. Полная структура формы/Form может быть представлена так (используя псевдо-код):

* Form (name: 'contacts')
  * Sheet (name: 'manager')
    * Field (type: 'input', label: 'Full name of manager')
    * Field (type: 'select', label: 'Office', items: 'Office A,Office B,Office C')
    * Field (type: 'relation', label: 'Profile page UID', table: 'pages')
      * Wizard (type: 'browse')
  * Sheet (name: 'assistant')
    * Field (type: 'input', label: 'Full name of assistant')
    * Field (type: 'input', label: 'Phone number')
    * Section (label: 'Email addresses')
      * Object (label: 'Email address')
      * Field (type: 'input', label: 'Email address')

Такая структура при формировании посредством TYPO3 правратится в:

1. Форму под названием "Contacts" с двумя вкладками: "Manager" и "Assistant".
2. Вкладка с названием "Manager" с тремя полями: имя менеджера, офис менеджера и персональная страничка менеджера на сайте
(если есть).
3. Вкладка с названием "Assistant" с двумя полями: имя ассистента и его телефонный номер.
4. Специальный раздел с повторяющимися объектами под названием "email address" с одним полем для адреса email может содержать любое количество таких адресов почты, которые можно добавлять и упорядочивать в виде списка объектов.

### Как использовать проекторы/ViewHelper компонентов форм

Доступ к проекторам/ViewHelpers Flux в шаблоне осуществяется посредством указания области именования/namespace, пример которой
приведён на справочной странице любого проектора/ViewHelper, а обработка происходит в соответствие с определённой версией
расширения (например, Flux ниже версии 7.0.0 обабатывает включение области именования/namespace в старом стиле, а Flux 7.0.0 и
новее — в новом). Область именования — все, что нужно для возможности использования проекторов/ViewHelpers, но, в зависимости
от того, что создаётся (страница, содержимое, дополнение и тому подобное), могут быть дополнительные требования (например,
 Fluidcontent и Fluidpages требуют специальный раздел/section `Configuration` в шаблоне).

После того, как стали понятны простейшие требования к структуре (другими словами, какие компоненты доступны в виде потомков
других компонентов) вопрос об использовании Flux в основном упирается в то, какие аргументы использовать и что каждый из них
будет делать. Убеждаемся, что аргументы имеют правильное название, а каждый — чётко документирован. Многие компоненты имеют те
же аргументы (name, label, default и так далее). Просто следуйте правилам структуры и создавайте свою форму, добавляя любое
количество нужных компонентов.

Обе разновидности - PHP и проекторы/ViewHelpers Fluid — имеют те же названия аргументов и вкладываются тем же способом. То
есть, можно использовать [справочник по проекторам/ViewHelper Flux](http://fluidtypo3.org/viewhelpers/flux.html) для изучения
аргументов, поддерживаемых проекторами/ViewHelpers, так и соответствующие им объекты PHP. Удостоверьтесь, что выбрали нужную версию Flux, так как некоторые названия свойств могут меняться в разных основных версиях.

Использование же PHP в IDE даёт возможность автозавершения и, помимо этого, в шаблонах Fluid нет той же гибкости в плане
автозавершения кода, но некоторые редакторы поддерживают схемы XSD, определяемые по стандартам XML, для автозавершения и базовой проверки синтаксиса и типов аргументов. Мы посвятили главу этой документации возможности автозавершения в [шаблонах Fluid посредством файлов схем XSD](../../5.Appendix/5.4.FluidTemplateAutoCompletion.md).

### Как использовать компоненты форм в PHP

Слой PHP API подразумевает сложное использование, прочитать об использовании компонентов и даже о создании собственных можно в [главе об использовании собственных компонентов](../../4.AdvancedProviders/4.3.CustomFormObjects/4.3.1.CreatingComponents.md). Изучение этих глав должно дать
очень чёткое представление о том, какую степень свободы получаете от использования своих компонентов форм. Хотя такое
использование компонентов и PHP обычно не понадобится, это позволяет продвинуться гораздо дальше, чем возможно при
использовании обыкновенных проекторов/ViewHelpers, и в плане производительности, и в плане повтоного использования.
